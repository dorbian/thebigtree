<!doctype html>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Forest Gallery</title>
<meta name="description" content="The home of the Forest — where elves gather to play games together, share art, and weave stories under the Big Tree.">
<meta property="og:title" content="Forest Gallery">
<meta property="og:description" content="The home of the Forest — where elves gather to play games together, share art, and weave stories under the Big Tree.">
<meta property="og:type" content="website">
<meta property="og:url" content="https://rites.thebigtree.life/">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Forest Gallery">
<meta name="twitter:description" content="The home of the Forest — where elves gather to play games together, share art, and weave stories under the Big Tree.">
<style>
  :root{
    --bg:#0b1310;
    --panel:#101a15;
    --text:#e7f2ea;
    --muted:#9fb4a6;
    --accent:#6bd4a2;
    --line:rgba(255,255,255,.08);
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font-family:"Spectral","Georgia",serif;
    color:var(--text);
    background:
      radial-gradient(1200px 700px at 10% -10%, rgba(107,212,162,.18), transparent 60%),
      linear-gradient(180deg, #0a120f, #0f1713 40%, #0a120f);
    background-repeat:no-repeat;
    background-size:cover;
    background-attachment:fixed;
  }
  header{
    padding:22px;
    border-bottom:1px solid var(--line);
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:16px;
  }
  .header-actions{
    display:flex;
    gap:10px;
    align-items:center;
  }
  .icon-link{
    width:36px;
    height:36px;
    border-radius:10px;
    border:1px solid rgba(107,212,162,.35);
    display:inline-flex;
    align-items:center;
    justify-content:center;
    color:var(--accent);
    text-decoration:none;
  }
  .icon-link svg{
    width:18px;
    height:18px;
    fill:currentColor;
  }
  header h1{margin:0 0 6px 0;letter-spacing:.05em}
  header p{margin:0;color:var(--muted)}
  .admin-link{
    color:var(--accent);
    text-decoration:none;
    font-size:13px;
    border:1px solid rgba(107,212,162,.35);
    padding:8px 12px;
    border-radius:999px;
    background:#0f1a14;
    white-space:nowrap;
  }
  .admin-link:hover{border-color:rgba(107,212,162,.7)}
  main{padding:20px}
  .row{display:flex;gap:12px;flex-wrap:wrap;align-items:end}
  label{color:var(--muted);font-size:12px}
  input, button{
    padding:8px 10px;
    border-radius:10px;
    border:1px solid var(--line);
    background:#0c1511;
    color:var(--text);
    font-family:inherit;
    font-size:14px;
  }
  button{background:#122019;border-color:rgba(107,212,162,.4);cursor:pointer}
  .grid{
    margin-top:16px;
    display:grid;
    grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));
    gap:14px;
  }
  .artist-link{
    color:var(--accent);
    text-decoration:none;
    font-size:12px;
    cursor:pointer;
    display:inline-block;
    margin:2px 0 6px 0;
  }
  .card{
    background:var(--panel);
    border:1px solid var(--line);
    border-radius:14px;
    padding:10px;
  }
  .card img{width:100%;border-radius:10px;margin-bottom:8px}
  .muted{color:var(--muted);font-size:12px}
  .links a{color:var(--accent);text-decoration:none;margin-right:8px;font-size:12px}
  .contest-pill{
    display:inline-block;
    margin-top:6px;
    padding:3px 8px;
    border-radius:999px;
    border:1px solid rgba(107,212,162,.35);
    color:var(--accent);
    font-size:11px;
  }
  .modal{
    position:fixed;
    inset:0;
    background:rgba(4,10,8,.72);
    display:none;
    align-items:center;
    justify-content:center;
    padding:24px;
    z-index:50;
  }
  .modal.show{display:flex}
  .modal-card{
    max-width:420px;
    width:100%;
    background:#0f1814;
    border:1px solid var(--line);
    border-radius:16px;
    padding:18px;
  }
  .modal-card h2{margin:0 0 10px 0;font-size:20px}
  .modal-links a{
    display:inline-block;
    margin:0 8px 8px 0;
    color:var(--accent);
    text-decoration:none;
    font-size:13px;
  }
  .modal-close{
    margin-top:12px;
    width:100%;
  }
  .image-modal{
    position:fixed;
    inset:0;
    background:rgba(4,10,8,.9);
    display:none;
    align-items:center;
    justify-content:center;
    z-index:70;
  }
  .image-modal.show{display:flex}
  .image-modal img{
    max-width:92vw;
    max-height:90vh;
    border-radius:16px;
    box-shadow:0 20px 60px rgba(0,0,0,.5);
  }
  .image-modal .info{
    position:absolute;
    top:16px;
    left:18px;
    color:var(--text);
    background:rgba(12,18,15,.85);
    border:1px solid var(--line);
    border-radius:10px;
    padding:8px 12px;
    font-size:13px;
    opacity:0;
    transition:opacity .2s ease;
  }
  .image-modal.show-info .info{opacity:1}
  .image-modal .close{
    position:absolute;
    top:12px;
    right:12px;
    width:36px;
    height:36px;
    border-radius:999px;
    border:1px solid var(--line);
    background:rgba(12,18,15,.9);
    color:var(--text);
    font-size:18px;
    cursor:pointer;
  }
</style>

<header>
  <div>
    <h1>Forest Gallery</h1>
    <p>Public art archive with artist credits.</p>
  </div>
  <div class="header-actions">
    <a class="icon-link" href="/tarot/calendar" aria-label="Forest calendar">
      <svg viewBox="0 0 24 24" aria-hidden="true">
        <path d="M7 2h2v2h6V2h2v2h3a1 1 0 0 1 1 1v15a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a1 1 0 0 1 1-1h4V2zm-3 6v12h16V8H4zm2 2h4v4H6v-4z"/>
      </svg>
    </a>
    <a class="icon-link" href="https://join.thebigtree.life" target="_blank" rel="noreferrer" aria-label="Join the Forest on Discord">
      <svg viewBox="0 0 24 24" aria-hidden="true">
        <path d="M20.5 4.6A18.5 18.5 0 0 0 16 3c-.2.4-.5 1-.6 1.4-1.7-.3-3.4-.3-5.1 0-.2-.5-.4-1-.6-1.4-1.6.4-3.1 1-4.5 1.6-2.9 4.3-3.7 8.5-3.3 12.6 2 1.5 3.9 2.4 5.9 3 .5-.7 1-1.5 1.3-2.3-.7-.2-1.4-.5-2-.9.2-.1.3-.3.5-.4 3.7 1.7 7.8 1.7 11.4 0 .2.1.3.3.5.4-.6.4-1.3.7-2 .9.4.8.8 1.6 1.3 2.3 2-.6 3.9-1.5 5.9-3 .5-4.1-.4-8.3-3.3-12.6zM9.5 15.4c-1.1 0-2-1-2-2.2 0-1.2.9-2.2 2-2.2s2 1 2 2.2c0 1.2-.9 2.2-2 2.2zm5 0c-1.1 0-2-1-2-2.2 0-1.2.9-2.2 2-2.2s2 1 2 2.2c0 1.2-.9 2.2-2 2.2z"/>
      </svg>
    </a>
  </div>
</header>

<main>
  <div class="grid" id="grid"></div>
</main>

<div class="modal" id="artistModal" role="dialog" aria-modal="true" aria-hidden="true">
  <div class="modal-card">
    <h2 id="artistName">Artist</h2>
    <div class="modal-links" id="artistLinks"></div>
    <button class="modal-close" id="artistClose">Close</button>
  </div>
</div>
<div class="image-modal" id="imageModal" aria-hidden="true">
  <div class="info" id="imageInfo"></div>
  <button class="close" id="imageClose" aria-label="Close">×</button>
  <img id="imageModalImg" alt="">
</div>

<script>
  const grid = document.getElementById("grid");
  const artistModal = document.getElementById("artistModal");
  const artistName = document.getElementById("artistName");
  const artistLinks = document.getElementById("artistLinks");
  const imageModal = document.getElementById("imageModal");
  const imageModalImg = document.getElementById("imageModalImg");
  const imageInfo = document.getElementById("imageInfo");
  let imageInfoTimer = null;

  function link(label, url){
    if (!url) return "";
    return `<a href="${url}" target="_blank" rel="noreferrer">${label}</a>`;
  }

  function openArtistModal(name, links){
    artistName.textContent = name || "Forest";
    const linkItems = Object.entries(links || {})
      .filter(([, url]) => url)
      .map(([label, url]) => `<a href="${url}" target="_blank" rel="noreferrer">${label}</a>`);
    artistLinks.innerHTML = linkItems.length ? linkItems.join("") : "<span class='muted'>Forest</span>";
    artistModal.classList.add("show");
    artistModal.setAttribute("aria-hidden", "false");
  }

  function closeArtistModal(){
    artistModal.classList.remove("show");
    artistModal.setAttribute("aria-hidden", "true");
  }

  function showImageInfo(){
    imageModal.classList.add("show-info");
    if (imageInfoTimer) clearTimeout(imageInfoTimer);
    imageInfoTimer = setTimeout(() => {
      imageModal.classList.remove("show-info");
    }, 2000);
  }

  function openImageModal(data){
    imageModalImg.src = data.url;
    imageModalImg.alt = data.title || "";
    imageInfo.textContent = data.info || "";
    imageModal.classList.add("show");
    imageModal.setAttribute("aria-hidden", "false");
    showImageInfo();
  }

  function closeImageModal(){
    imageModal.classList.remove("show");
    imageModal.setAttribute("aria-hidden", "true");
    imageModalImg.src = "";
    imageInfo.textContent = "";
  }

  async function load(){
    const res = await fetch(`/api/gallery/images`);
    const data = await res.json();
    if (!data.ok){
      grid.innerHTML = "<div class='muted'>Gallery unavailable.</div>";
      return;
    }
    const items = data.items || [];
    if (!items.length){
      grid.innerHTML = "<div class='muted'>No images yet.</div>";
      return;
    }
    grid.innerHTML = items.map(c => {
      const artist = c.artist || {};
      const artistName = artist.name || "Forest";
      const artistLinks = artist.links || {};
      const infoParts = [c.title || "Untitled", artistName];
      if (c.contest) infoParts.push(c.contest);
      const infoText = infoParts.filter(Boolean).join(" \u2014 ");
      const artistPayload = encodeURIComponent(JSON.stringify({
        name: artistName,
        links: artistLinks
      }));
      return `
        <div class="card">
          ${c.url ? `<img src="${c.url}" alt="${c.title || ""}" data-full='${encodeURIComponent(JSON.stringify({url: c.url, info: infoText, title: c.title || ""}))}'>` : ""}
          <div><strong>${c.title || ""}</strong></div>
          <div><a class="artist-link" href="#" data-artist="${artistPayload}">${artistName}</a></div>
          ${c.contest ? `<div class="contest-pill">${c.contest}</div>` : ""}
          <div class="links">
            ${link("Instagram", artistLinks.instagram)}
            ${link("Bluesky", artistLinks.bluesky)}
            ${link("X", artistLinks.x)}
            ${link("ArtStation", artistLinks.artstation)}
            ${link("Website", artistLinks.website)}
          </div>
        </div>
      `;
    }).join("");
  }

  document.getElementById("artistClose").addEventListener("click", closeArtistModal);
  artistModal.addEventListener("click", (event) => {
    if (event.target === artistModal) closeArtistModal();
  });
  document.getElementById("imageClose").addEventListener("click", closeImageModal);
  imageModal.addEventListener("click", (event) => {
    if (event.target === imageModal) closeImageModal();
  });
  imageModal.addEventListener("mousemove", showImageInfo);
  grid.addEventListener("click", (event) => {
    const target = event.target;
    if (target.tagName === "IMG" && target.getAttribute("data-full")){
      event.preventDefault();
      try{
        const payload = JSON.parse(decodeURIComponent(target.getAttribute("data-full")));
        openImageModal(payload);
      }catch (err){
        return;
      }
      return;
    }
    if (!target.classList || !target.classList.contains("artist-link")) return;
    event.preventDefault();
    const payload = target.getAttribute("data-artist");
    if (!payload) return;
    try{
      const parsed = JSON.parse(decodeURIComponent(payload));
      openArtistModal(parsed.name, parsed.links);
    }catch (err){
      openArtistModal("Forest", {});
    }
  });
  window.addEventListener("keydown", (event) => {
    if (event.key === "Escape" && imageModal.classList.contains("show")){
      closeImageModal();
    }
  });
  load();
</script>
