<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Forest Management</title>
    <link rel="icon" href="/icon.png" type="image/png">
    <link rel="stylesheet" href="/static/overlay/overlay.css">
    <style>
      .dashboard-kpis-row {
        display: flex;
        align-items: flex-start;
        gap: 16px;
        flex-wrap: wrap;
        margin-bottom: 16px;
      }
      .dashboard-kpis {
        display: flex;
        flex-wrap: wrap;
        gap: 12px;
      }
      .dashboard-kpis .stat-card {
        flex: 1;
        min-width: 160px;
        padding: 14px 16px;
        border: 1px solid rgba(255, 255, 255, .1);
        border-radius: 12px;
        background: rgba(255, 255, 255, .02);
      }
      .dashboard-kpis .stat-value {
        font-size: 2rem;
        font-weight: 600;
        line-height: 1.2;
      }
      .dashboard-kpis .stat-label {
        font-size: 0.85rem;
        text-transform: uppercase;
        letter-spacing: .08em;
        margin-top: 6px;
        color: rgba(231, 242, 234, .7);
      }
      .dashboard-admin-actions {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-bottom: 16px;
      }
      .dashboard-admin-actions button,
      .dashboard-admin-actions a {
        border: 1px solid rgba(255, 255, 255, .15);
        background: rgba(255, 255, 255, .03);
        color: #e7f2ea;
        border-radius: 12px;
        padding: 10px 14px;
        font-size: 0.9rem;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        cursor: pointer;
        text-decoration: none;
      }
      .dashboard-admin-actions button svg {
        width: 20px;
        height: 20px;
        fill: currentColor;
      }
      .dashboard-admin-actions button span {
        white-space: nowrap;
      }
      .dashboard-stats-refresh {
        margin-left: auto;
        border: none;
        background: none;
        color: #6bd4a2;
        font-size: 0.85rem;
        cursor: pointer;
        align-self: flex-start;
      }
    </style>
  </head>
  <body>
    <button class="overlay-exit" id="overlayExit">Exit overlay</button>
    <div class="login-screen" id="loginView">
      <div class="login-card">
        <div class="login-title">Forest Management</div>
        <div class="login-sub">Enter your API key to manage the forest.</div>
        <label for="apiKeyLogin">API key</label>
        <input id="apiKeyLogin" placeholder="Paste /auth token">
        <button id="loginBtn">Login</button>
        <div class="status" id="loginStatus">Ready.</div>
      </div>
    </div>

    <div class="app-shell hidden" id="appView">
      <aside class="sidebar">
        <div class="sidebar-body">
          <div class="nav-block">
            <div class="brand">Forest Management</div>
            <div class="brand-user hidden" id="brandUser">
              <img id="brandUserIcon" alt="" class="hidden">
              <svg viewBox="0 0 24 24" aria-hidden="true" id="brandUserFallback">
                <path d="M12 4a4 4 0 1 1-4 4 4 4 0 0 1 4-4zm0 10c3.31 0 6 1.34 6 3v3H6v-3c0-1.66 2.69-3 6-3z"/>
              </svg>
              <span id="brandUserName"></span>
            </div>
          </div>

          <div class="nav-block">
            <div class="nav-title">Home</div>
            <div class="menu-item" id="menuDashboard" tabindex="0">
              <span class="menu-label">Dashboard</span>
            </div>
          </div>

          <div class="nav-block">
            <div class="nav-title">Bingo</div>
            <div class="menu-item" id="menuBingo" tabindex="0">
              <span class="menu-label">Manager</span>
              <div class="menu-actions">
                <button class="menu-refresh" id="menuBingoRefresh" title="Refresh games" aria-label="Refresh games">
                  <svg viewBox="0 0 24 24" aria-hidden="true">
                    <path d="M12 5a7 7 0 1 1-6.65 9H3a9 9 0 1 0 2.64-6.36L3 6v6h6l-2.55-2.55A7 7 0 0 1 12 5z"/>
                  </svg>
                </button>
                <button class="menu-refresh" id="menuCreateGame" title="New game" aria-label="New game">
                  <svg viewBox="0 0 24 24" aria-hidden="true">
                    <path d="M11 5h2v14h-2zM5 11h14v2H5z"/>
                  </svg>
                </button>
              </div>
            </div>
            <div class="menu-sub" id="menuGames"></div>
            <div class="hidden" id="menuCreateGamePlaceholder"></div>
          </div>

          <div class="nav-block">
            <div class="nav-title">Cardgames</div>
            <div class="menu-item" id="menuTarotLinks" tabindex="0"><span class="menu-label">Tarot Sessions</span></div>
            <div class="menu-item" id="menuCardgameSessions" tabindex="0"><span class="menu-label">Cardgame Sessions</span></div>
            <div class="menu-item" id="menuTarotDecks" tabindex="0"><span class="menu-label">Deck Editor</span></div>
          </div>

          <div class="nav-block">
            <div class="nav-title">Discord</div>
            <div class="menu-item" id="menuContests" tabindex="0"><span class="menu-label">Contests</span></div>
          </div>


          <div class="nav-block">
            <div class="nav-title">Status</div>
            <div class="status-bar status" id="status">
              <span class="status-dot" id="statusDot" aria-hidden="true"></span>
              <span id="statusText">Idle</span>
              <span class="status-time" id="statusTime">--:--</span>
            </div>
          </div>
        </div>
        <input type="checkbox" id="overlayMode" class="hidden">
      </aside>
      <main class="content">
      <div class="grid">
        <section class="panel dashboard hidden" style="animation-delay:.02s" id="dashboardPanel">
          <h2>Forest Dashboard</h2>
          <p class="muted">Operational notes, quick starts, and live runbooks for the forest services.</p>
          <div class="dashboard-kpis-row">
            <div class="dashboard-kpis" id="dashboardStats">
              <article class="stat-card">
                <div class="stat-value" id="dashStatDiscord">--</div>
                <div class="stat-label">Discord members</div>
              </article>
              <article class="stat-card">
                <div class="stat-value" id="dashStatPlayers">--</div>
                <div class="stat-label">Players engaged</div>
              </article>
              <article class="stat-card">
                <div class="stat-value" id="dashStatRegistered">--</div>
                <div class="stat-label">Registered users</div>
              </article>
              <article class="stat-card">
                <div class="stat-value" id="dashStatGames">--</div>
                <div class="stat-label">API games</div>
              </article>
            </div>
            <button class="dashboard-stats-refresh" id="dashboardStatsRefresh" type="button">Refresh stats</button>
          </div>
          <div class="dashboard-admin-actions" aria-label="Administration tools">
            <button type="button" id="menuAuthRoles">
              <svg viewBox="0 0 24 24" aria-hidden="true">
                <path d="M12 2a5 5 0 0 1 5 5v3h2a1 1 0 0 1 1 1v9a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2v-9a1 1 0 0 1 1-1h2V7a5 5 0 0 1 5-5zm-3 8h6V7a3 3 0 0 0-6 0v3z"/>
              </svg>
              <span>Auth roles</span>
            </button>
            <button type="button" id="menuAuthKeys">
              <svg viewBox="0 0 24 24" aria-hidden="true">
                <path d="M12 1a7 7 0 0 0-4.3 12.5l-2.2 2.2V19h3.3l1.2-1.2h1.4l1.2-1.2h1.5l1.6-1.6A7 7 0 1 0 12 1zm0 4a3 3 0 1 1-3 3 3 3 0 0 1 3-3z"/>
              </svg>
              <span>Auth keys</span>
            </button>
            <button type="button" id="menuAuthTemp">
              <svg viewBox="0 0 24 24" aria-hidden="true">
                <path d="M12 2a6 6 0 0 1 6 6v3h2a1 1 0 0 1 1 1v7a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2v-7a1 1 0 0 1 1-1h2V8a6 6 0 0 1 6-6zm-4 9h8V8a4 4 0 1 0-8 0v3z"/>
              </svg>
              <span>Temporary access</span>
            </button>
            <button type="button" id="menuSystemConfig">
              <svg viewBox="0 0 24 24" aria-hidden="true">
                <path d="M12 8a4 4 0 1 0 4 4 4 4 0 0 0-4-4zm6.39 3a6.5 6.5 0 0 0-.32-1l1.92-1.18-1-1.73-2.03.71a6.45 6.45 0 0 0-1.1-.64L15 5h-2l-.85 1.16a6.45 6.45 0 0 0-1.11.64l-2.04-.7-1 1.73 1.92 1.18a6.5 6.5 0 0 0-.32 1L3 12l1.16.85a6.5 6.5 0 0 0 .32 1l-1.92 1.18 1 1.73 2.03-.71a6.45 6.45 0 0 0 1.1.64L11 21h2l.85-1.16a6.45 6.45 0 0 0 1.11-.64l2.04.7 1-1.73-1.92-1.18a6.5 6.5 0 0 0 .32-1L21 12z"/>
              </svg>
              <span>System config</span>
            </button>
            <a id="dashboardXivAuthLink" class="dashboard-admin-link" href="/user-area/manage" target="_blank" rel="noreferrer">
              <svg viewBox="0 0 24 24" aria-hidden="true">
                <path d="M12 12c2.21 0 4-1.79 4-4S14.21 4 12 4 8 5.79 8 8s1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
              </svg>
              <span>XivAuth management</span>
            </a>
          </div>
          <div class="dashboard-readme" style="margin-top:12px">
            <div class="dash-toc">
              <strong>Table of contents</strong>
              <ul>
                <li><a href="#dash-changelog">Recent changes</a></li>
                <li><a href="#dash-overview">Overview</a></li>
                <li><a href="#dash-quickstart">Quick start</a></li>
                <li><a href="#dash-cardgames">Cardgame sessions</a></li>
                <li><a href="#dash-tarot">Tarot sessions</a></li>
                <li><a href="#dash-gallery">Gallery & media</a></li>
                <li><a href="#dash-decks">Deck editor</a></li>
                <li><a href="#dash-starting">Rites starting page</a></li>
                <li><a href="#dash-troubleshoot">Troubleshooting</a></li>
                <li><a href="#dash-thanks">Thank you</a></li>
              </ul>
            </div>

            <details class="dash-section" id="dash-changelog" open>
              <summary>Recent changes</summary>
              <div class="dash-section-body">
                <div class="dash-changelog" id="dashChangelog">Loading changelog...</div>
              </div>
            </details>

            <details class="dash-section" id="dash-overview" open>
              <summary>Overview</summary>
              <div class="dash-section-body">
                <div class="dash-blocks">
                  <div class="dash-block">
                    <div class="dash-label">Core tools</div>
                    <ul class="dash-list">
                      <li>Discord bot for commands and permissions.</li>
                      <li>Overlay dashboard for operations.</li>
                      <li>Rites gallery and media library.</li>
                      <li>Tarot + cardgames session pages.</li>
                    </ul>
                  </div>
                  <div class="dash-block">
                    <div class="dash-label">Key links</div>
                    <div class="dash-links">
                      <a href="/overlay">Overlay dashboard</a>
                      <a href="/tarot/gallery" target="_blank" rel="noreferrer">Forest gallery</a>
                      <a href="/tarot/overlay" target="_blank" rel="noreferrer">Tarot overlay</a>
                      <button id="updatePlogonmasterBtn" class="btn btn-sm btn-secondary">Update Plugin Master</button>
                    </div>
                  </div>
                  <div class="dash-block">
                    <div class="dash-label">Auth</div>
                    <p>Run <span class="cmd">/auth</span> in Discord and paste the token into the login prompt.</p>
                  </div>
                </div>
              </div>
            </details>

            <details class="dash-section" id="dash-quickstart" open>
              <summary>Quick start (daily ops)</summary>
              <div class="dash-section-body">
                <ol class="dash-list">
                  <li>Run <span class="cmd">/auth</span> in Discord and log in here.</li>
                  <li>Open the panel you need: Bingo, Tarot Sessions, or Cardgame Sessions.</li>
                  <li>Create the session, open host view in a new tab, and share the player link.</li>
                  <li>Finish or delete sessions once the ritual is complete.</li>
                </ol>
                <div class="dash-note">Tip: host views open in a new tab by default so you can keep the dashboard open.</div>
              </div>
            </details>

            <details class="dash-section" id="dash-cardgames" open>
              <summary>Cardgame sessions (Blackjack / Poker / High-Low)</summary>
              <div class="dash-section-body">
                <div class="dash-blocks">
                  <div class="dash-block">
                    <div class="dash-label">Create</div>
                    <ul class="dash-list">
                      <li>Select game, deck, pot.</li>
                      <li>Optional: pick a background from Media.</li>
                      <li>Click Create session.</li>
                    </ul>
                  </div>
                  <div class="dash-block">
                    <div class="dash-label">Host flow</div>
                    <ul class="dash-list">
                      <li>Open host view (new tab).</li>
                      <li>Click Start when ready.</li>
                      <li>Finish or Delete when done.</li>
                    </ul>
                  </div>
                  <div class="dash-block">
                    <div class="dash-label">Player sharing</div>
                    <p>Use the Player link shown under Links, or the copy button in the host view.</p>
                  </div>
                </div>
              </div>
            </details>

            <details class="dash-section" id="dash-tarot" open>
              <summary>Tarot sessions</summary>
              <div class="dash-section-body">
                <ul class="dash-list">
                  <li>Open Tarot Sessions and create a session.</li>
                  <li>Use the Priestess/Player links for control vs view.</li>
                  <li>Close the session when the reading ends to archive results.</li>
                </ul>
              </div>
            </details>

            <details class="dash-section" id="dash-gallery">
              <summary>Gallery & media</summary>
              <div class="dash-section-body">
                <div class="dash-blocks">
                  <div class="dash-block">
                    <div class="dash-label">Media library</div>
                    <p>Upload, tag, and hide items. Use the Media panel to manage visibility.</p>
                  </div>
                  <div class="dash-block">
                    <div class="dash-label">Gallery</div>
                    <p>Gallery is a shrine. Hide finished decks or items via the Media panel.</p>
                  </div>
                </div>
              </div>
            </details>

            <details class="dash-section" id="dash-decks">
              <summary>Deck editor</summary>
              <div class="dash-section-body">
                <ul class="dash-list">
                  <li>Use Deck Editor to edit cards, suits, and images.</li>
                  <li>Cardgames read standard playing cards by suit + rank or card_id patterns.</li>
                  <li>For playing decks, fill suit and number and keep card images set.</li>
                </ul>
              </div>
            </details>

            <details class="dash-section" id="dash-starting">
              <summary>Rites starting page</summary>
              <div class="dash-section-body">
                <ul class="dash-list">
                  <li>Used when rites is booting or a 502/503 occurs.</li>
                  <li>Shows the heart splash and forwards once rites is up.</li>
                  <li>Container config lives in the middleware folder.</li>
                </ul>
              </div>
            </details>

            <details class="dash-section" id="dash-troubleshoot">
              <summary>Troubleshooting</summary>
              <div class="dash-section-body">
                <div class="dash-issue">
                  <p><strong>Tools locked:</strong> run <span class="cmd">/auth</span> and re-login.</p>
                </div>
                <div class="dash-issue">
                  <p><strong>Player view not updating:</strong> refresh the page or reopen the session link.</p>
                </div>
                <div class="dash-issue">
                  <p><strong>Media not loading:</strong> confirm the URL in Media library and reselect.</p>
                </div>
              </div>
            </details>

            <details class="dash-section" id="dash-thanks">
              <summary>Thank you</summary>
              <div class="dash-section-body">
                <p class="muted">Thank you for tending the Forest. Every ritual and repair keeps the canopy strong.</p>
              </div>
            </details>
          </div>
        </section>
          <section class="panel" style="animation-delay:.05s" id="bingoPanel">
            <h2>Bingo Manager</h2>

            <div class="bingo-section bingo-control">
              <h3>Game Control</h3>
              <div class="bingo-status-display" id="bGameStatusDisplay">
                <div class="bingo-status-label" id="bGameStatusText">Waiting to Start</div>
                <div class="bingo-status-meta" id="bGameStatusMeta">No game selected.</div>
                <div class="status-badge" id="bGameStatus">No game</div>
              </div>
              <div class="bingo-primary-row">
                <button class="btn-ghost" id="bStart">Start game</button>
                <button class="btn-ghost" id="bRoll">Call next number</button>
                <button class="btn-ghost" id="bAdvanceStage">Advance stage</button>
                <button class="btn-ghost" id="bRefresh">Refresh</button>
                <button class="btn-ghost danger-btn" id="bCloseGame">Close game</button>
              </div>
              <div class="bingo-feedback">
                <div class="bingo-last-action" id="bLastAction">Last action: -</div>
                <div class="bingo-history" id="bHistory">
                  <div class="muted">No history yet.</div>
                </div>
              </div>
              <div class="status" id="bingoStatus">No game selected.</div>
            </div>

            <div class="section-divider"></div>

            <div class="bingo-section">
              <h3>Players &amp; Cards</h3>
              <div class="empty-state" id="bOwnersEmpty">
                <div class="muted">No players yet. Refresh to pull current owners.</div>
                <button class="btn-ghost" id="bOwnersRefresh">Refresh players</button>
              </div>
              <div class="list" id="bOwners"></div>
            </div>

            <div class="section-divider"></div>

            <div class="bingo-section">
              <h3>Game State &amp; History</h3>
              <div class="bingo-summary" id="bSummary">
                <div>Title: <span id="bTitleVal">No title</span></div>
                <div>Header: <span id="bHeaderVal">No header</span></div>
                <div>Stage: <span id="bStageVal">No stage</span></div>
                <div>Pot: <span id="bPotVal">No pot</span></div>
              </div>
              <div class="bingo-called" id="bCalled">No numbers called yet.</div>
              <div class="bingo-called-grid" id="bCalledGrid"></div>
              <div class="bingo-card" id="bCard">
                <div class="bingo-header" id="bCardHeader"></div>
                <div class="bingo-grid" id="bCardGrid"></div>
              </div>
            </div>

            <div class="section-divider"></div>

            <details class="bingo-advanced" id="bingoAdvanced">
              <summary>Advanced</summary>
              <div class="bingo-advanced-body">
                <div class="row">
                  <div>
                    <label>Game ID</label>
                    <div id="bGameId" class="status">No game selected.</div>
                  </div>
                  <div>
                    <label for="bCountsPot">
                      <input type="checkbox" id="bCountsPot" checked>
                      Counts toward pot
                    </label>
                  </div>
                  <div>
                    <label for="bSeedPotAmount">Seed pot</label>
                    <input id="bSeedPotAmount" type="number" value="0" min="0">
                  </div>
                  <div>
                    <label>&nbsp;</label>
                    <button class="btn-ghost" id="bSeedPotApply">Seed pot</button>
                  </div>
                </div>
                <div class="row">
                  <div>
                    <label for="bOwner"><span class="req">*</span> Owner name</label>
                    <input id="bOwner" placeholder="Player name">
                  </div>
                  <div>
                    <label for="bQty">Quantity</label>
                    <input id="bQty" type="number" value="1" min="1" max="10">
                  </div>
                  <div>
                    <label>&nbsp;</label>
                    <button id="bBuy" class="btn-ghost">Buy</button>
                  </div>
                </div>
              </div>
            </details>

            <details class="bingo-advanced" id="bingoAdmin">
              <summary>Admin Tools</summary>
              <div class="bingo-advanced-body">
                <div class="row">
                  <div>
                    <label for="bOwnerId">Discord ID</label>
                    <input id="bOwnerId" placeholder="optional">
                  </div>
                  <div>
                    <label>&nbsp;</label>
                    <button class="btn-ghost" id="bViewOwner">View tickets</button>
                  </div>
                </div>
                <div class="row">
                  <div>
                    <label>Announce calls</label>
                    <div class="bingo-announce">
                      <input type="checkbox" id="bAnnounceToggle">
                      <span class="status-badge" id="bAnnounceBadge">Off</span>
                    </div>
                  </div>
                </div>
                <div class="list" id="bClaims">No claims yet.</div>
              </div>
            </details>
          </section>

        <section class="panel" style="animation-delay:.1s" id="tarotLinksPanel">
          <h2>Tarot Sessions</h2>
          <p>Open the player, priestess, or overlay view.</p>
          <div class="row">
            <div>
              <label for="tSessionSelect">Existing sessions</label>
              <select id="tSessionSelect"></select>
            </div>
            <div>
              <label>&nbsp;</label>
              <button id="tSessionRefresh" class="menu-refresh" title="Refresh sessions" aria-label="Refresh sessions">
                <svg viewBox="0 0 24 24" aria-hidden="true">
                  <path d="M12 5a7 7 0 1 1-6.65 9H3a9 9 0 1 0 2.64-6.36L3 6v6h6l-2.55-2.55A7 7 0 0 1 12 5z"/>
                </svg>
              </button>
            </div>
            <div>
              <label>&nbsp;</label>
              <button id="tCreateSession">New session</button>
            </div>
          </div>
          <div class="row">
            <div>
              <label for="tJoinCode">Join code</label>
              <input id="tJoinCode" placeholder="e.g. AB12CD">
            </div>
            <div>
              <label for="tPriestessToken">Priestess token</label>
              <input id="tPriestessToken" placeholder="token (for priestess)">
            </div>
          </div>
          <div class="row">
            <div>
              <label>&nbsp;</label>
              <button id="tOpenPlayer">Open player</button>
            </div>
            <div>
              <label>&nbsp;</label>
              <button id="tOpenPriestess">Open priestess</button>
            </div>
            <div>
              <label>&nbsp;</label>
              <button id="tOpenOverlay">Open overlay</button>
            </div>
            <div>
              <label>&nbsp;</label>
              <button class="btn-ghost" id="tCloseSession">Close session</button>
            </div>
          </div>
          <div class="row links">
            <div>
              <span class="pill">Links</span>
              <div id="tLink">No join code entered.</div>
            </div>
          </div>
          <h3>Tarot Games</h3>
          <p>Create and manage tarot sessions.</p>
          <div class="status hidden" id="tSpreadNote">
            Spread = the card layout for the reading. Single: one card. Tree: Root/Trunk/Canopy. Cross: Past/Present/Future.
          </div>
        </section>

        <section class="panel hidden" style="animation-delay:.1s" id="cardgameSessionsPanel">
          <h2>Cardgame Sessions</h2>
          <p>Create and manage sessions for blackjack, poker, and high/low.</p>
            <div class="row">
              <div>
                <label for="cgGameSelect">Game</label>
                <select id="cgGameSelect">
                  <option value="blackjack">Blackjack</option>
                  <option value="poker">Poker</option>
                  <option value="highlow">High/Low</option>
                </select>
              </div>
              <div>
                <label for="cgDeckSelect">Deck</label>
                <div class="row">
                  <select id="cgDeckSelect"></select>
                  <button class="btn-ghost icon-btn" id="cgDeckRefresh" title="Refresh decks" aria-label="Refresh decks">
                    <svg viewBox="0 0 24 24" aria-hidden="true">
                      <path d="M12 5a7 7 0 1 1-6.65 9H3a9 9 0 1 0 2.64-6.36L3 6v6h6l-2.55-2.55A7 7 0 0 1 12 5z"/>
                    </svg>
                  </button>
                </div>
              </div>
              <div>
                <label>&nbsp;</label>
                <input id="cgPot" placeholder="0">
              </div>
              <div>
                <label for="cgCurrency">Currency</label>
                <input id="cgCurrency" placeholder="gil">
              </div>
            </div>
          <div class="row">
            <div>
              <label for="cgBackgroundUrl">Background image</label>
              <input id="cgBackgroundUrl" placeholder="/media/forest.png or https://...">
            </div>
            <div>
              <label>&nbsp;</label>
              <button class="btn-ghost" id="cgUseSelectedMedia">Use selected media</button>
            </div>
            <div>
              <label>&nbsp;</label>
              <button class="btn-ghost" id="cgOpenMedia">Open media library</button>
            </div>
          </div>
          <div class="status" id="cgBackgroundStatus">No background selected.</div>
            <div class="row">
              <div>
                <label>&nbsp;</label>
                <button id="cgCreateSession">Create draft</button>
              </div>
              <div>
                <label>&nbsp;</label>
                <button class="btn-ghost" id="cgCreateFromSelected">Create next from selected</button>
              </div>
            </div>
          <div class="row">
            <div>
              <label for="cgSessionSelect">Existing sessions</label>
              <select id="cgSessionSelect"></select>
            </div>
            <div>
              <label>&nbsp;</label>
              <button id="cgSessionRefresh" class="menu-refresh" title="Refresh sessions" aria-label="Refresh sessions">
                <svg viewBox="0 0 24 24" aria-hidden="true">
                  <path d="M12 5a7 7 0 1 1-6.65 9H3a9 9 0 1 0 2.64-6.36L3 6v6h6l-2.55-2.55A7 7 0 0 1 12 5z"/>
                </svg>
              </button>
            </div>
          </div>
          <div class="row">
            <div>
              <label for="cgJoinCode">Join code</label>
              <input id="cgJoinCode" placeholder="e.g. AB12CD">
            </div>
            <div>
              <label for="cgPriestessToken">Host token</label>
              <input id="cgPriestessToken" placeholder="token (for host)">
            </div>
          </div>
          <div class="row">
            <div>
              <label>&nbsp;</label>
              <button id="cgOpenPlayer">Open player</button>
            </div>
            <div>
              <label>&nbsp;</label>
              <button id="cgOpenPriestess">Open host</button>
            </div>
            <div>
              <label>&nbsp;</label>
              <button class="btn-ghost" id="cgFinishSession">Finish session</button>
            </div>
            <div>
              <label>&nbsp;</label>
              <button class="btn-ghost danger-action" id="cgDeleteSession">Delete session</button>
            </div>
          </div>
          <div class="row links">
            <div>
              <span class="pill">Links</span>
              <div id="cgLink">No join code entered.</div>
            </div>
          </div>
          <div class="status" id="cgStatus">Ready.</div>
        </section>

        <section class="panel hidden" style="animation-delay:.1s" id="tarotDecksPanel">
          <h2>Deck Editor</h2>
          <div class="context-header">
            <div>
              <div class="context-path" id="taContextPath">Deck Editor / Forest / No card selected</div>
              <div class="context-meta" id="taContextMeta">Pick a card to edit.</div>
            </div>
            <div class="context-meta" id="taContextDeck"></div>
          </div>
          <div class="row">
            <div>
              <label for="taDeck">Deck</label>
              <select id="taDeck"></select>
            </div>
            <div>
              <label>&nbsp;</label>
              <div class="icon-group">
                <button class="btn-ghost icon-btn" id="taAddDeck" title="Add deck">
                  <svg viewBox="0 0 24 24" aria-hidden="true">
                    <path d="M11 5h2v14h-2zM5 11h14v2H5z"/>
                  </svg>
                </button>
                <button class="btn-ghost icon-btn" id="taEditDeck" title="Edit deck">
                  <svg viewBox="0 0 24 24" aria-hidden="true">
                    <path d="M4 15.5V20h4.5L19 9.5l-4.5-4.5L4 15.5zm16.4-9.9a1.5 1.5 0 0 0 0-2.1l-1.9-1.9a1.5 1.5 0 0 0-2.1 0l-1.5 1.5 4.5 4.5 1.5-1.5z"/>
                  </svg>
                </button>
                <button class="btn-ghost icon-btn danger-action" id="taDeleteDeck" title="Delete deck">
                  <svg viewBox="0 0 24 24" aria-hidden="true">
                    <path d="M6 7h12v2H6zM9 9h2v9H9zm4 0h2v9h-2zM8 5h8l-1-1h-6l-1 1z"/>
                  </svg>
                </button>
              </div>
            </div>
          </div>
          <div class="list" id="taDeckList">No deck loaded.</div>
          <div class="status" id="taDeckStatus">Pick a deck to begin.</div>

          <div class="section-divider"></div>
          <h3>Card Editor</h3>
          <div class="deck-editor-grid">
            <div class="deck-editor-column">
              <h4>Identity</h4>
              <div class="row">
                <div>
                  <label for="taCardId">Card ID</label>
                  <input id="taCardId" placeholder="candlecap_sprite">
                </div>
              </div>
              <div class="row">
                <div>
                  <label for="taCardName">Name</label>
                  <input id="taCardName" placeholder="Candlecap Sprite">
                </div>
              </div>
              <div class="row">
                <div>
                  <label for="taCardSuit">Suit</label>
                  <input id="taCardSuit" list="taSuitList" placeholder="Major">
                  <datalist id="taSuitList">
                    <option value="Major"></option>
                    <option value="Wands"></option>
                    <option value="Cups"></option>
                    <option value="Swords"></option>
                    <option value="Pentacles"></option>
                    <option value="Hearts"></option>
                    <option value="Spades"></option>
                    <option value="Clubs"></option>
                    <option value="Diamonds"></option>
                  </datalist>
                </div>
                <div>
                  <label for="taCardNumber">Number</label>
                  <input id="taCardNumber" list="taNumberList" placeholder="XIV or 14">
                  <datalist id="taNumberList"></datalist>
                </div>
              </div>
              <div class="row">
                <div>
                  <label for="taCardTags">Tags</label>
                  <input id="taCardTags" placeholder="mischief,curiosity">
                </div>
              </div>
            </div>
            <div class="deck-editor-column">
              <h4>Meaning</h4>
              <div class="row">
                <div>
                  <label for="taCardFlavor">Flavor text</label>
                  <textarea id="taCardFlavor" rows="2" placeholder="Short flavor line for the card..."></textarea>
                </div>
              </div>
              <div class="row">
                <div>
                  <label for="taCardUpright">Upright</label>
                  <textarea id="taCardUpright"></textarea>
                </div>
              </div>
              <div class="row">
                <div>
                  <label for="taCardReversed">Reversed</label>
                  <textarea id="taCardReversed"></textarea>
                </div>
              </div>
            </div>
            <div class="deck-editor-column">
              <h4>Meta</h4>
              <div class="row">
                <div>
                  <label>Theme weights</label>
                  <div class="theme-grid" id="taCardThemes"></div>
                  <div class="muted" id="taCardThemesHint">Select a suit to see theme weights.</div>
                </div>
              </div>
              <div class="row">
                <div>
                  <label>Suit info</label>
                  <div class="list" id="taSuitInfo">Pick a suit to see details.</div>
                </div>
              </div>
              <div class="row">
                <div>
                  <label>Number info</label>
                  <div class="list" id="taNumberInfo">Pick a number to see details.</div>
                </div>
              </div>
              <div class="row">
                <div>
                  <label>Card image</label>
                  <button class="btn-ghost icon-btn" id="taCardLibrary" title="Choose from library">
                    <svg viewBox="0 0 24 24" aria-hidden="true">
                      <path d="M4 5h16a1 1 0 0 1 1 1v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V6a1 1 0 0 1 1-1zm0 2v10h15a0 0 0 0 0 0 0V7H4zm3 8 3-4 3 3 2-2 4 5H7z"/>
                    </svg>
                  </button>
                </div>
              </div>
              <input id="taCardArtist" type="hidden">
              <div class="row">
                <div>
                  <label>Card preview</label>
                  <div class="preview-grid">
                    <div class="preview-card" id="taFrontPreview"><span class="preview-label">Front</span></div>
                    <div class="preview-card" id="taBackPreview"><span class="preview-label">Back</span></div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="row">
            <div>
              <label>&nbsp;</label>
              <button id="taSaveCard" class="btn-primary">
                <svg viewBox="0 0 24 24" aria-hidden="true">
                  <path d="M17 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V7l-4-4zM12 19a3 3 0 1 1 0-6 3 3 0 0 1 0 6zm3-10H5V5h10v4z"/>
                </svg>
                Save card
              </button>
            </div>
          </div>
        </section>

        <section class="panel hidden" style="animation-delay:.1s" id="contestPanel">
          <h2>Discord</h2>
          <div class="row">
            <div>
              <label>&nbsp;</label>
              <button class="btn-ghost" id="contestRefresh">Refresh contests</button>
            </div>
            <div>
              <label>&nbsp;</label>
              <button class="btn-ghost" id="contestCreateChannelOpen">Create contest channel</button>
            </div>
          </div>
          <div class="muted" id="contestHelp">Create and run contests for a channel. Missing data will show an alert with a quick fix.</div>
          <div class="section-divider"></div>
          <h3>Create Contest</h3>
          <div class="row">
            <div>
              <label for="contestChannel">Channel</label>
              <select id="contestChannel"></select>
            </div>
            <div>
              <label>&nbsp;</label>
              <button class="menu-refresh" id="contestChannelRefresh" title="Refresh channels" aria-label="Refresh channels">
                <svg viewBox="0 0 24 24" aria-hidden="true">
                  <path d="M12 5a7 7 0 1 1-6.65 9H3a9 9 0 1 0 2.64-6.36L3 6v6h6l-2.55-2.55A7 7 0 0 1 12 5z"/>
                </svg>
              </button>
            </div>
            <div>
              <label for="contestTitle">Title</label>
              <input id="contestTitle" placeholder="Elfoween Costume Contest">
            </div>
            <div>
              <label for="contestDeadline">Deadline</label>
              <input id="contestDeadline" placeholder="2025-10-31 23:59">
            </div>
          </div>
          <div class="row">
            <div>
              <label for="contestDescription">Description</label>
              <textarea id="contestDescription" placeholder="Post your entry as an attachment. Most :TreeCone: wins!"></textarea>
            </div>
            <div>
              <label for="contestRules">Rules</label>
              <textarea id="contestRules" placeholder="Leave empty for defaults."></textarea>
            </div>
          </div>
          <div class="row">
            <div>
              <label for="contestEmoji">Vote emoji</label>
              <input id="contestEmoji" placeholder=":TreeCone:">
            </div>
            <div>
              <label>&nbsp;</label>
              <button id="contestCreate">Create contest</button>
            </div>
          </div>
          <div class="status" id="contestCreateStatus">Select a channel to create a contest.</div>
          <h3>Contest overview</h3>
          <div class="contest-grid">
            <div>
              <div class="list-header">Active</div>
              <div class="list" id="contestAllList">No contests loaded.</div>
            </div>
            <div>
              <div class="list-header">Ended</div>
              <div class="list" id="contestEndedList">No ended contests yet.</div>
            </div>
          </div>
          <div class="section-divider"></div>
          <h3>TarotCards</h3>
          <div class="row">
            <div>
              <label for="tarotClaimsDeck">Deck</label>
              <select id="tarotClaimsDeck"></select>
            </div>
            <div>
              <label for="tarotClaimsChannel">Channel</label>
              <select id="tarotClaimsChannel"></select>
            </div>
            <div>
              <label for="tarotClaimsLimit">Claim limit</label>
              <input id="tarotClaimsLimit" type="number" value="2" min="1" max="10">
            </div>
          </div>
          <div class="row">
            <div>
              <label>&nbsp;</label>
              <button class="btn-ghost" id="tarotClaimsRefresh">Refresh lists</button>
            </div>
            <div>
              <label>&nbsp;</label>
              <button id="tarotClaimsPost">Post TarotCards board</button>
            </div>
          </div>
          <div class="status" id="tarotClaimsStatus">Pick a deck and channel to post.</div>
        </section>
        <section class="panel hidden" style="animation-delay:.1s" id="mediaPanel">
          <h2>Media Library</h2>
          <p>Upload, review, and manage images used across the Forest.</p>
          <div class="library-layout">
            <div>
                <div class="media-tabs">
                  <button class="media-tab active" id="mediaTabUploadBtn" data-tab="upload">Upload</button>
                  <button class="media-tab" id="mediaTabEditBtn" data-tab="edit" disabled title="Select an image to edit">Edit</button>
                </div>
              <div class="media-tab-panel active" id="mediaTabUpload">
                <div class="library-section-title">Upload</div>
                <div class="upload-drop" id="mediaUploadDrop" role="button" tabindex="0">
                  <div class="upload-drop-title" id="mediaUploadDropTitle">Drag &amp; drop an image</div>
                  <div class="upload-drop-meta" id="mediaUploadDropMeta">PNG, JPG, GIF, WEBP</div>
                  <div class="upload-drop-cta" id="mediaUploadDropCta">or click to choose</div>
                </div>
                <input id="mediaUploadFile" type="file" accept="image/*" class="hidden">
                <div class="row">
                  <div>
                    <label for="mediaUploadTitleInput">Title</label>
                    <input id="mediaUploadTitleInput" placeholder="Image title">
                  </div>
                  <div>
                    <label for="mediaUploadArtist">Artist</label>
                    <select id="mediaUploadArtist"></select>
                  </div>
                  <div>
                    <label for="mediaUploadOriginType">Origin type</label>
                    <select id="mediaUploadOriginType">
                      <option value="Artifact">Artifact</option>
                      <option value="Rite">Rite</option>
                      <option value="Contest">Contest</option>
                      <option value="Tarot">Tarot</option>
                      <option value="Bingo">Bingo</option>
                      <option value="Gallery">Gallery</option>
                    </select>
                  </div>
                  <div>
                    <label for="mediaUploadOriginLabel">Origin label</label>
                    <input id="mediaUploadOriginLabel" placeholder="Offered during...">
                  </div>
                </div>
                <div class="row">
                  <div>
                    <label>&nbsp;</label>
                    <button id="mediaUploadUpload" disabled>Upload</button>
                  </div>
                </div>
                  <div class="status" id="mediaUploadStatus">Upload idle.</div>
              </div>
                <div class="media-tab-panel" id="mediaTabEdit">
                  <div class="library-section-title">Edit</div>
                  <div class="media-empty" id="mediaEditEmpty">Select an image to edit.</div>
                  <div class="media-edit-card hidden" id="mediaEditCard">
                    <div class="media-edit-preview" id="mediaEditPreview"></div>
                    <div class="row">
                    <div>
                      <label>&nbsp;</label>
                      <button class="btn-ghost" id="mediaEditCopy" disabled>Copy URL</button>
                    </div>
                    <div>
                      <label>&nbsp;</label>
                      <button class="btn-ghost" id="mediaEditOpen" disabled>Open</button>
                    </div>
                    <div>
                      <label>&nbsp;</label>
                      <button class="btn-ghost btn-danger" id="mediaEditDelete" disabled>Delete</button>
                    </div>
                      <div>
                        <label>&nbsp;</label>
                        <button class="btn-ghost" id="mediaEditHide" disabled>Hide in gallery</button>
                      </div>
                    </div>
                    <div class="row">
                      <div>
                        <label>&nbsp;</label>
                        <button class="btn-ghost" id="mediaEditClear" disabled>Clear selection</button>
                      </div>
                    </div>
                    <div class="row">
                      <div>
                        <label>Selected</label>
                        <div class="status" id="mediaEditIdentity">-</div>
                      </div>
                    <div>
                      <label>Artist</label>
                      <div class="status" id="mediaEditArtistDisplay">-</div>
                    </div>
                    <div>
                      <label>Origin</label>
                      <div class="status" id="mediaEditOriginDisplay">-</div>
                    </div>
                  </div>
                  <div class="media-edit-meta" id="mediaEditMeta"></div>
                  <div class="row">
                    <div>
                      <label for="mediaEditFilename">Filename</label>
                      <input id="mediaEditFilename" readonly>
                    </div>
                    <div>
                      <label for="mediaEditTitle">Title</label>
                      <input id="mediaEditTitle" placeholder="Image title">
                    </div>
                    <div>
                      <label for="mediaEditArtist">Artist</label>
                      <select id="mediaEditArtist"></select>
                    </div>
                    <div>
                      <label for="mediaEditOriginType">Origin type</label>
                      <select id="mediaEditOriginType">
                        <option value="Artifact">Artifact</option>
                        <option value="Rite">Rite</option>
                        <option value="Contest">Contest</option>
                        <option value="Tarot">Tarot</option>
                        <option value="Bingo">Bingo</option>
                        <option value="Gallery">Gallery</option>
                      </select>
                    </div>
                    <div>
                      <label for="mediaEditOriginLabel">Origin label</label>
                      <input id="mediaEditOriginLabel" placeholder="Offered during...">
                    </div>
                  </div>
                    <div class="row">
                      <div>
                        <label>&nbsp;</label>
                        <button id="mediaEditSave" disabled>Save changes</button>
                      </div>
                    </div>
                    <div class="status" id="mediaEditStatus">Select an image to edit.</div>
                  </div>
                </div>
                <div class="section-divider"></div>
                <details class="media-filters-wrap" id="mediaFiltersWrap">
                  <summary id="mediaFiltersSummary">Filters (0 active)</summary>
                  <div class="media-filters">
                    <select id="mediaFilterArtist">
                      <option value="">All artists</option>
                    </select>
                    <select id="mediaFilterOriginType">
                      <option value="">All origins</option>
                      <option value="Artifact">Artifact</option>
                      <option value="Rite">Rite</option>
                      <option value="Contest">Contest</option>
                      <option value="Tarot">Tarot</option>
                      <option value="Bingo">Bingo</option>
                      <option value="Gallery">Gallery</option>
                    </select>
                    <select id="mediaFilterLabel">
                      <option value="any">Any label</option>
                      <option value="has">Has label</option>
                      <option value="none">Untagged</option>
                    </select>
                    <button class="btn-ghost" id="mediaFilterClear" type="button">Clear filters</button>
                  </div>
                </details>
              </div>
              <div>
                <div class="media-toolbar">
                  <div class="library-section-title">Existing media</div>
                  <button class="btn-ghost icon-btn icon-btn--small" id="mediaLibraryRefresh" title="Refresh" aria-label="Refresh">
                    <svg viewBox="0 0 24 24" aria-hidden="true">
                      <path d="M12 5a7 7 0 1 1-6.65 9H3a9 9 0 1 0 2.64-6.36L3 6v6h6l-2.55-2.55A7 7 0 0 1 12 5z"/>
                    </svg>
                  </button>
                  <input id="mediaToolbarSearch" placeholder="Search title, artist, label">
                  <select id="mediaToolbarSort">
                    <option value="new">Newest first</option>
                    <option value="old">Oldest first</option>
                    <option value="title">Title A-Z</option>
                    <option value="artist">Artist A-Z</option>
                  </select>
                  <div class="media-selection" id="mediaSelectionIndicator">0 selected</div>
                </div>
                <div class="bulk-bar" id="mediaBulkBar">
                  <span class="count" id="mediaBulkCount">0 selected</span>
                  <button class="btn-ghost btn-danger" id="mediaBulkDelete">Delete</button>
                  <button class="btn-ghost" id="mediaBulkHide">Hide</button>
                <button class="btn-ghost" id="mediaBulkShow">Show</button>
                <select id="mediaBulkArtist"></select>
                <button id="mediaBulkSetArtist">Set artist</button>
                <select id="mediaBulkOriginType">
                  <option value="">Origin type</option>
                  <option value="Artifact">Artifact</option>
                  <option value="Rite">Rite</option>
                  <option value="Contest">Contest</option>
                  <option value="Tarot">Tarot</option>
                  <option value="Bingo">Bingo</option>
                  <option value="Gallery">Gallery</option>
                </select>
                <button id="mediaBulkSetOrigin">Set origin</button>
                  <input id="mediaBulkLabel" placeholder="Origin label">
                  <button id="mediaBulkApplyLabel">Set label</button>
                  <button class="btn-ghost" id="mediaBulkClearLabel">Clear label</button>
                </div>
                <div class="status" id="mediaLibraryStatus">Library idle.</div>
                <div class="preview-grid" id="mediaLibraryGrid"></div>
              </div>
          </div>
        </section>
        <div class="modal" id="contestChannelModal">
          <div class="modal-card">
            <div class="modal-header">
              <div class="modal-title">Create Contest Channel</div>
              <button class="btn-ghost" id="contestChannelClose">Close</button>
            </div>
            <div class="row">
              <div>
                <label>Category</label>
                <div class="status" id="contestCategoryStatus">1239558949351460904</div>
              </div>
              <div>
                <label for="contestTemplateChannel">Template channel</label>
                <select id="contestTemplateChannel"></select>
              </div>
            </div>
            <div class="row">
              <div>
                <label for="contestEmojiSelect">Channel emoji</label>
                <select id="contestEmojiSelect">
                  <option value=""></option>
                  <option value=""></option>
                  <option value=""></option>
                  <option value=""></option>
                  <option value=""></option>
                </select>
              </div>
              <div>
                <label for="contestChannelName">Channel name</label>
                <input id="contestChannelName" placeholder="elfoween">
              </div>
            </div>
            <div class="row">
              <div>
                <label>Preview</label>
                <div class="status" id="contestChannelPreview">elfoween</div>
              </div>
              <div>
                <label>&nbsp;</label>
                <button id="contestChannelCreate">Create channel</button>
              </div>
            </div>
            <div class="status" id="contestChannelStatus">Ready.</div>
          </div>
        </div>

      </div>
      </main>
    </div>
    <div class="modal" id="bCreateModal">
      <div class="modal-card">
        <div class="modal-header">
          <div class="modal-title">Create Bingo Game</div>
          <button class="btn-ghost" id="bCloseCreate">Close</button>
        </div>
        <div class="row">
          <div>
            <label for="bTitle">Title</label>
            <input id="bTitle" placeholder="Bingo Night">
          </div>
          <div>
            <label for="bHeader">Header</label>
            <input id="bHeader" placeholder="BING" maxlength="4">
          </div>
          <div>
            <label for="bPrice">Price</label>
            <input id="bPrice" type="number" value="10000">
          </div>
          <div>
            <label for="bCurrency">Currency</label>
            <input id="bCurrency" value="gil">
          </div>
            <div>
              <label for="bMaxCards">Max cards</label>
              <input id="bMaxCards" type="number" value="10">
            </div>
            <div>
              <label for="bSeedPot">Seed pot</label>
              <input id="bSeedPot" type="number" value="0" min="0">
            </div>
          </div>
        <div class="row">
          <div>
            <label for="bChannelSelect">Channel list</label>
            <select id="bChannelSelect"></select>
          </div>
          <div>
            <label>&nbsp;</label>
            <button class="menu-refresh" id="bChannelRefresh" title="Refresh channels" aria-label="Refresh channels">
              <svg viewBox="0 0 24 24" aria-hidden="true">
                <path d="M12 5a7 7 0 1 1-6.65 9H3a9 9 0 1 0 2.64-6.36L3 6v6h6l-2.55-2.55A7 7 0 0 1 12 5z"/>
              </svg>
            </button>
          </div>
        </div>
        <input id="bChannel" type="hidden">
        <input id="bCreatedBy" type="hidden">
        <div class="row">
          <div>
            <label for="bAnnounceCalls">
              <input type="checkbox" id="bAnnounceCalls">
              Announce calls in Discord
            </label>
          </div>
          <div>
            <label for="bTheme">Theme color</label>
            <input id="bTheme" type="color" value="#9de07d">
          </div>
          <div>
            <label>Background image</label>
            <button class="btn-ghost icon-btn" id="bCreateBgLibrary" title="Choose from library">
              <svg viewBox="0 0 24 24" aria-hidden="true">
                <path d="M4 5h16a1 1 0 0 1 1 1v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V6a1 1 0 0 1 1-1zm0 2v10h15a0 0 0 0 0 0 0V7H4zm3 8 3-4 3 3 2-2 4 5H7z"/>
              </svg>
            </button>
          </div>
          <div>
            <label>&nbsp;</label>
            <button id="bCreate">Create</button>
          </div>
        </div>
        <div class="status" id="bCreateBgStatus">No background selected.</div>
        <div class="status" id="bCreatePayload">Payload preview: channel_id=?, created_by=?</div>
      </div>
    </div>
    <div class="modal" id="bOwnerModal">
      <div class="modal-card modal-card--wide">
        <div class="modal-header">
          <div class="modal-title">Player Cards</div>
          <button class="btn-ghost" id="bOwnerClose">Close</button>
        </div>
        <div class="context-header" id="bOwnerSummary">
          <div>
            <div class="context-path">Viewing cards for: -</div>
            <div class="context-meta">Total cards: 0</div>
          </div>
          <div class="context-meta owner-filter" id="bOwnerLegend">
            <button class="owner-filter-btn" id="bOwnerFilterCalled" type="button">Called (0)</button>
            <button class="owner-filter-btn" id="bOwnerFilterUncalled" type="button">Uncalled (0)</button>
          </div>
        </div>
        <div class="owner-card-list" id="bOwnerCards">No tickets loaded.</div>
      </div>
    </div>
    <div class="modal" id="bPurchaseModal">
      <div class="modal-card">
        <div class="modal-header">
          <div class="modal-title">Player Link</div>
          <button class="btn-ghost" id="bPurchaseClose">Close</button>
        </div>
        <div class="row">
          <div>
            <label for="bPurchaseLink">Player link</label>
            <input id="bPurchaseLink" readonly>
          </div>
          <div>
            <label>&nbsp;</label>
            <button class="btn-ghost" id="bPurchaseCopy">Copy link</button>
          </div>
        </div>
        <div class="status" id="bPurchaseStatus">Ready.</div>
      </div>
    </div>
    <div class="modal" id="uploadLibraryModal">
      <div class="modal-card">
        <div class="modal-header">
          <div class="modal-title" id="uploadLibraryTitle">Image Library</div>
          <button class="btn-ghost" id="uploadLibraryClose">Close</button>
        </div>
        <div class="library-layout">
          <section class="library-upload">
            <div class="library-section-title">Add new media</div>
            <div class="upload-drop" id="uploadLibraryDrop" role="button" tabindex="0">
              <div class="upload-drop-title" id="uploadLibraryDropTitle">Drag &amp; drop an image</div>
              <div class="upload-drop-meta" id="uploadLibraryDropMeta">PNG, JPG, GIF, WEBP</div>
              <div class="upload-drop-cta" id="uploadLibraryDropCta">or click to choose</div>
            </div>
            <input id="uploadLibraryFile" type="file" accept="image/*" class="hidden">
            <div>
              <label for="uploadLibraryTitleInput">Title</label>
              <input id="uploadLibraryTitleInput" placeholder="Image title">
            </div>
            <div>
              <label for="uploadLibraryArtist">Artist</label>
              <select id="uploadLibraryArtist"></select>
            </div>
            <button id="uploadLibraryUpload" disabled>Upload</button>
            <div class="status" id="uploadLibraryStatus">Ready.</div>
          </section>
          <section class="library-browser">
            <div class="library-section-title">Existing media</div>
            <div class="library-toolbar">
              <button class="btn-ghost" id="uploadLibraryRefresh">Refresh</button>
            </div>
            <div class="library-grid-scroll">
              <div class="preview-grid" id="uploadLibraryGrid"></div>
            </div>
          </section>
        </div>
      </div>
    </div>
    <div class="modal" id="deckCreateModal">
      <div class="modal-card">
        <div class="modal-header">
          <div class="modal-title">Create Deck</div>
          <button class="btn-ghost" id="deckCreateClose">Close</button>
        </div>
        <div class="row">
          <div>
            <label for="deckCreateId">Deck ID</label>
            <input id="deckCreateId" placeholder="elf-classic">
          </div>
          <div>
            <label for="deckCreateName">Name</label>
            <input id="deckCreateName" placeholder="Elf Classic">
          </div>
          <div>
            <label for="deckCreateTheme">Card theme</label>
            <select id="deckCreateTheme">
              <option value="classic">Classic</option>
              <option value="wood">Wood</option>
              <option value="neon">Neon</option>
            </select>
          </div>
        </div>
        <div class="row">
          <div>
            <label>Deck back</label>
            <button class="btn-ghost icon-btn" id="deckCreateBackPick" title="Choose back image">
              <svg viewBox="0 0 24 24" aria-hidden="true">
                <path d="M4 5h16a1 1 0 0 1 1 1v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V6a1 1 0 0 1 1-1zm0 2v10h15a0 0 0 0 0 0 0V7H4zm3 8 3-4 3 3 2-2 4 5H7z"/>
              </svg>
            </button>
          </div>
          <div>
            <label>Back preview</label>
            <div class="preview-card" id="deckCreateBackPreview"><span class="preview-label">Back</span></div>
          </div>
          <div>
            <label for="deckCreateSeed">Seed cards</label>
            <select id="deckCreateSeed">
              <option value="none">None</option>
              <option value="dummy">Dummy per suit</option>
              <option value="default">Default seed</option>
            </select>
          </div>
          <div>
            <label for="deckCreatePerHouse">Per suit</label>
            <input id="deckCreatePerHouse" type="number" value="4" min="0">
          </div>
          <div>
            <label for="deckCreateCrown">Crown</label>
            <input id="deckCreateCrown" type="number" value="1" min="0">
          </div>
        </div>
        <div class="row">
          <div>
            <label>&nbsp;</label>
            <button id="deckCreateSubmit">Create deck</button>
          </div>
        </div>
        <div class="section-divider"></div>
        <h3>Suit Themes</h3>
        <div class="row">
          <div>
            <label for="deckCreateSuitPreset">Suit preset</label>
            <select id="deckCreateSuitPreset">
              <option value="forest">Forest (Roots/Canopy/Ember/Whisper/Crown)</option>
              <option value="tarot">Tarot (Major/Wands/Cups/Swords/Pentacles)</option>
              <option value="playing">Playing Cards (Hearts/Spades/Clubs/Diamonds)</option>
              <option value="custom">Custom</option>
            </select>
          </div>
        </div>
        <div class="row">
          <div>
            <label for="deckCreateSuitJson">Suit definitions (JSON)</label>
            <textarea id="deckCreateSuitJson" rows="6" placeholder='[{"id":"Roots","name":"Roots","themes":{"foundation":3,"memory":2,"stability":3},"keywords":["home","tradition","endurance","belonging"]}]'></textarea>
          </div>
        </div>
      </div>
    </div>
    <div class="modal" id="deckEditModal">
      <div class="modal-card">
        <div class="modal-header">
          <div class="modal-title">Edit Deck</div>
          <button class="btn-ghost" id="deckEditClose">Close</button>
        </div>
        <div class="row">
          <div>
            <label for="deckEditName">Name</label>
            <input id="deckEditName" placeholder="Elf Classic">
          </div>
          <div>
            <label for="deckEditTheme">Card theme</label>
            <select id="deckEditTheme">
              <option value="classic">Classic</option>
              <option value="wood">Wood</option>
              <option value="neon">Neon</option>
            </select>
          </div>
        </div>
        <div class="row">
          <div>
            <label>Deck back</label>
            <button class="btn-ghost icon-btn" id="deckEditBackPick" title="Choose back image">
              <svg viewBox="0 0 24 24" aria-hidden="true">
                <path d="M4 5h16a1 1 0 0 1 1 1v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V6a1 1 0 0 1 1-1zm0 2v10h15a0 0 0 0 0 0 0V7H4zm3 8 3-4 3 3 2-2 4 5H7z"/>
              </svg>
            </button>
          </div>
          <div>
            <label>Back preview</label>
            <div class="preview-card" id="deckEditBackPreview"><span class="preview-label">Back</span></div>
          </div>
        </div>
        <div class="row">
          <div>
            <label>&nbsp;</label>
            <label><input type="checkbox" id="deckEditHideGallery"> Hide this deck from the gallery</label>
          </div>
        </div>
        <div class="row">
          <div>
            <label>&nbsp;</label>
            <button id="deckEditSubmit">Save changes</button>
          </div>
        </div>
        <div class="section-divider"></div>
        <h3>Suit Themes</h3>
        <div class="row">
          <div>
            <label for="deckEditSuitPreset">Suit preset</label>
            <select id="deckEditSuitPreset">
              <option value="forest">Forest (Roots/Canopy/Ember/Whisper/Crown)</option>
              <option value="tarot">Tarot (Major/Wands/Cups/Swords/Pentacles)</option>
              <option value="playing">Playing Cards (Hearts/Spades/Clubs/Diamonds)</option>
              <option value="custom">Custom</option>
            </select>
          </div>
        </div>
        <div class="row">
          <div>
            <label for="deckEditSuitJson">Suit definitions (JSON)</label>
            <textarea id="deckEditSuitJson" rows="6" placeholder='[{"id":"Roots","name":"Roots","themes":{"foundation":3,"memory":2,"stability":3},"keywords":["home","tradition","endurance","belonging"]}]'></textarea>
          </div>
        </div>
      </div>
    </div>
    <div class="modal" id="sessionCreateModal">
      <div class="modal-card">
        <div class="modal-header">
          <div class="modal-title">Create Session</div>
          <button class="btn-ghost" id="sessionCreateClose">Close</button>
        </div>
        <div class="row">
          <div>
            <label for="sessionCreateDeck">Deck</label>
            <select id="sessionCreateDeck"></select>
          </div>
          <div>
            <label for="sessionCreateSpread">Spread</label>
            <select id="sessionCreateSpread">
              <option value="single">Single</option>
              <option value="tree">Tree</option>
              <option value="cross">Cross</option>
            </select>
          </div>
        </div>
        <div class="row">
          <div>
            <label>&nbsp;</label>
            <button id="sessionCreateSubmit">Create session</button>
          </div>
        </div>
      </div>
    </div>
    <div class="modal" id="mediaModal">
      <div class="modal-card">
        <div class="modal-header">
          <div class="modal-title">Media Management</div>
          <button class="btn-ghost" id="mediaClose">Close</button>
        </div>
        <div class="row">
          <div>
            <label>&nbsp;</label>
            <button class="btn-ghost icon-btn" id="mediaLibraryOpen" title="Open library">
              <svg viewBox="0 0 24 24" aria-hidden="true">
                <path d="M4 5h16a1 1 0 0 1 1 1v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V6a1 1 0 0 1 1-1zm0 2v10h15a0 0 0 0 0 0 0V7H4zm3 8 3-4 3 3 2-2 4 5H7z"/>
              </svg>
            </button>
          </div>
          <div class="muted" style="align-self:center">Upload and select images from the library.</div>
        </div>
      </div>
    </div>
    <div class="modal" id="artistModal">
      <div class="modal-card">
        <div class="modal-header">
          <div class="modal-title">Artist Index</div>
          <button class="btn-ghost" id="artistClose">Close</button>
        </div>
        <div class="row">
          <div>
            <label for="artistIndexSelect">Artist list</label>
            <select id="artistIndexSelect"></select>
          </div>
          <div>
            <label>&nbsp;</label>
            <button class="btn-ghost" id="artistIndexRefresh">Refresh</button>
          </div>
        </div>
        <div class="row">
          <div>
            <label for="artistIndexId">Artist ID (optional)</label>
            <input id="artistIndexId" placeholder="artist_id">
          </div>
          <div>
            <label for="artistIndexName">Name</label>
            <input id="artistIndexName" placeholder="Artist name">
          </div>
        </div>
        <div class="row">
          <div>
            <label for="artistIndexInstagram">Instagram</label>
            <input id="artistIndexInstagram" placeholder="https://instagram.com/...">
          </div>
          <div>
            <label for="artistIndexBluesky">Bluesky</label>
            <input id="artistIndexBluesky" placeholder="https://bsky.app/profile/...">
          </div>
          <div>
            <label for="artistIndexX">X / Twitter</label>
            <input id="artistIndexX" placeholder="https://x.com/...">
          </div>
          <div>
            <label for="artistIndexArtstation">ArtStation</label>
            <input id="artistIndexArtstation" placeholder="https://artstation.com/...">
          </div>
        </div>
          <div class="row">
            <div>
              <label for="artistIndexWebsite">Website</label>
              <input id="artistIndexWebsite" placeholder="https://...">
            </div>
            <div>
              <label for="artistIndexLinktree">Linktree</label>
              <input id="artistIndexLinktree" placeholder="https://linktr.ee/...">
            </div>
          </div>
          <div class="row">
            <div>
              <label>&nbsp;</label>
              <button id="artistIndexSave">Save artist</button>
            </div>
            <div>
              <label>&nbsp;</label>
              <button class="btn-ghost" id="artistIndexDelete">Delete artist</button>
            </div>
          </div>
      </div>
    </div>
    <div class="modal" id="calendarModal">
      <div class="modal-card">
        <div class="modal-header">
          <div class="modal-title">Forest Calendar</div>
          <button class="btn-ghost" id="calendarClose">Close</button>
        </div>
        <div class="row">
          <div>
            <label for="calendarMonth">Month</label>
            <select id="calendarMonth"></select>
          </div>
          <div>
            <label for="calendarTitle">Title</label>
            <input id="calendarTitle" placeholder="Optional title">
          </div>
        </div>
        <div class="row">
          <div>
            <label>Artist</label>
            <div class="status" id="calendarArtist">Forest</div>
          </div>
        </div>
        <div class="row">
          <button class="btn-ghost" id="calendarPick">Pick from library</button>
          <button id="calendarSave">Save month</button>
          <button class="btn-ghost" id="calendarClear">Clear month</button>
          <button class="btn-ghost" id="calendarRefresh">Refresh</button>
        </div>
        <div class="row">
          <div>
            <label>Preview</label>
            <div class="preview-card" id="calendarPreview"></div>
          </div>
        </div>
        <div class="status" id="calendarStatus">Ready.</div>
      </div>
    </div>
    <div class="modal" id="galleryModal">
      <div class="modal-card modal-card--wide">
        <div class="modal-header">
          <div class="modal-title">Image Uploader</div>
          <button class="btn-ghost" id="galleryClose">Close</button>
        </div>
        <h3>Upload Channel</h3>
        <div class="row">
          <div>
            <label for="galleryUploadChannel">Upload channel</label>
            <select id="galleryUploadChannel"></select>
          </div>
          <div>
            <label>&nbsp;</label>
            <button class="btn-ghost" id="galleryChannelRefresh">Refresh channels</button>
          </div>
          <div>
            <label>&nbsp;</label>
            <button id="galleryChannelSave">Save channel</button>
          </div>
        </div>
        <div class="row">
          <div>
            <label for="galleryChannelName">Create channel name</label>
            <input id="galleryChannelName" placeholder="forest-gallery-uploads">
          </div>
          <div>
            <label for="galleryChannelCategory">Category ID</label>
            <input id="galleryChannelCategory" placeholder="1234567890">
          </div>
          <div>
            <label for="galleryChannelTemplate">Template channel</label>
            <select id="galleryChannelTemplate"></select>
          </div>
          <div>
            <label>&nbsp;</label>
            <button class="btn-ghost" id="galleryChannelCreate">Create channel</button>
          </div>
        </div>
        <div class="status" id="galleryChannelStatus">Pick a channel to use for uploads.</div>
        <div class="section-divider"></div>
        <div class="row">
          <div>
            <label>&nbsp;</label>
            <button class="btn-ghost" id="galleryImportOpen">Import from Discord channel</button>
          </div>
        </div>
      </div>
    </div>
    <div class="modal" id="galleryImportModal">
      <div class="modal-card">
        <div class="modal-header">
          <div class="modal-title">Import Gallery Images</div>
          <button class="btn-ghost" id="galleryImportClose">Close</button>
        </div>
        <div class="row">
          <div>
            <label for="galleryImportChannel">Source channel</label>
            <select id="galleryImportChannel"></select>
          </div>
          <div>
            <label>&nbsp;</label>
            <button class="btn-ghost" id="galleryImportRefresh">Refresh channels</button>
          </div>
        </div>
        <div class="row">
          <div>
            <label for="galleryImportOriginType">Origin type</label>
            <select id="galleryImportOriginType">
              <option value="Artifact">Artifact</option>
              <option value="Rite">Rite</option>
              <option value="Contest">Contest</option>
              <option value="Tarot">Tarot</option>
              <option value="Bingo">Bingo</option>
              <option value="Gallery">Gallery</option>
            </select>
          </div>
          <div>
            <label for="galleryImportOriginLabel">Origin label</label>
            <input id="galleryImportOriginLabel" placeholder="Offered during...">
          </div>
        </div>
        <div class="row">
          <div>
            <label>&nbsp;</label>
            <button id="galleryImportRun">Import images</button>
          </div>
        </div>
        <div class="status" id="galleryImportStatus">Pick a channel to import.</div>
      </div>
    </div>
    <div class="modal" id="authRolesModal">
      <div class="modal-card">
        <div class="modal-header">
          <div class="modal-title">Auth Roles</div>
          <button class="btn-ghost" id="authRolesClose">Close</button>
        </div>
        <div class="row">
          <div>
            <label>&nbsp;</label>
            <button class="btn-ghost" id="authRolesRefresh">Refresh roles</button>
          </div>
          <div class="muted" style="align-self:center">Select scopes each role can reach via /auth.</div>
        </div>
        <div class="role-table-wrap" id="authRolesWrap">
          <div class="list" id="authRolesList">No roles loaded.</div>
        </div>
        <div class="row">
          <div>
            <label for="authRoleIds">Selected role IDs</label>
            <input id="authRoleIds" readonly>
          </div>
          <div>
            <label>&nbsp;</label>
            <button id="authRolesSave">Save</button>
          </div>
        </div>
        <div class="status" id="authRolesStatus">Ready.</div>
      </div>
    </div>
    <div class="modal" id="authTokensModal">
      <div class="modal-card">
        <div class="modal-header">
          <div class="modal-title">Auth Keys</div>
          <button class="btn-ghost" id="authTokensClose">Close</button>
        </div>
        <div class="row">
          <div>
            <label>&nbsp;</label>
            <button class="btn-ghost" id="authTokensRefresh">Refresh keys</button>
          </div>
          <div class="muted" style="align-self:center">Active web tokens and remaining lifetime.</div>
        </div>
        <div class="role-table-wrap" id="authTokensWrap">
          <div class="list" id="authTokensList">No keys loaded.</div>
        </div>
        <div class="status" id="authTokensStatus">Ready.</div>
      </div>
    </div>
    <div class="modal" id="authTempModal">
      <div class="modal-card">
        <div class="modal-header">
          <h3>Temporary Access Link</h3>
          <button class="btn-ghost" id="authTempClose">Close</button>
        </div>
        <div class="modal-content">
          <div class="form-row">
            <label for="authTempRole">Access profile (role scope)</label>
            <select id="authTempRole"></select>
            <div class="muted auth-temp-scopes" id="authTempScopesPreview"></div>
          </div>
          <div class="form-row">
            <label for="authTempScopes">Scopes override (optional, comma separated)</label>
            <input id="authTempScopes" placeholder="bingo:admin, tarot:admin">
          </div>
          <div class="form-row">
            <button id="authTempGenerate">Generate 6 hour link</button>
          </div>
          <div class="form-row">
            <label for="authTempUrl">Temporary link</label>
            <input id="authTempUrl" readonly>
            <button class="btn-ghost" id="authTempCopy" type="button">Copy link</button>
          </div>
          <div class="muted">Link is single-use. The session lasts 6 hours after activation.</div>
        </div>
        <div class="status" id="authTempStatus">Ready.</div>
      </div>
    </div>
    <div class="modal" id="systemConfigModal">
      <div class="modal-card modal-card--wide">
        <div class="modal-header">
          <div class="modal-title">System Configuration</div>
          <button class="btn-ghost" id="systemConfigClose">Close</button>
        </div>
        <div class="row" style="display:flex;gap:16px;flex-wrap:wrap;">
          <div style="flex:1;min-width:260px;">
            <h3>XivAuth</h3>
            <p class="muted" style="margin-top:0;margin-bottom:8px;">Values are persisted to PostgreSQL and imported from the INI defaults on first boot.</p>
            <label>
              Verify URL
              <input id="systemXivVerifyUrl" type="url" placeholder="https://xivauth.net/verify">
            </label>
            <label>
              API key (optional)
              <input id="systemXivApiKey" type="password" autocomplete="off" placeholder="Bearer token (optional)">
            </label>
            <label>
              Default username
              <input id="systemXivDefaultUsername" placeholder="xivplayer">
            </label>
            <label>
              Timeout (seconds)
              <input id="systemXivTimeout" type="number" min="1" step="1">
            </label>
            <button id="systemXivSave">Save XivAuth</button>
          </div>
          <div style="flex:1;min-width:260px;">
            <h3>OpenAI</h3>
            <p class="muted" style="margin-top:0;margin-bottom:8px;">Imported from <code>[openai]</code> and env vars if available.</p>
            <label>
              API key
              <input id="systemOpenAIKey" type="password" autocomplete="off">
            </label>
            <label>
              Model
              <input id="systemOpenAIModel" placeholder="gpt-4o-mini">
            </label>
            <label>
              Temperature
              <input id="systemOpenAITemperature" type="number" min="0" max="2" step="0.01">
            </label>
            <label>
              Max tokens
              <input id="systemOpenAITokens" type="number" min="1" step="1">
            </label>
            <label>
              <input id="systemOpenAIEnablePriest" type="checkbox">
              Enable priest chat
            </label>
            <button id="systemOpenAISave">Save OpenAI</button>
          </div>
        </div>
        <div class="status" id="systemConfigStatus">Ready.</div>
      </div>
    </div>
    <div class="toast-stack" id="toastStack"></div>
    <script src="/static/overlay/overlay.js?v=20260116c" defer></script>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
      const btn = document.getElementById("updatePlogonmasterBtn");
      if (btn) {
        btn.addEventListener("click", async function() {
          btn.disabled = true;
          btn.textContent = "Updating...";
          try {
            const resp = await fetch("/admin/update_with_leaf", {
              method: "POST",
              headers: {
                "Content-Type": "application/json"
              }
            });
            const data = await resp.json();
            if (data.ok) {
              showToast("with.leaf updated successfully.");
            } else {
              showToast("Update failed: " + (data.error || "Unknown error"));
            }
          } catch (err) {
            showToast("Update failed: " + err);
          }
          btn.disabled = false;
          btn.textContent = "Update Plugin Master";
        });
      }
      function showToast(msg) {
        const stack = document.getElementById("toastStack");
        if (!stack) return;
        const toast = document.createElement("div");
        toast.className = "toast";
        toast.textContent = msg;
        stack.appendChild(toast);
        setTimeout(() => { toast.remove(); }, 3500);
      }
    });
    </script>
  </body>
</html>


















